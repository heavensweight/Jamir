<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OAuth Callback</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h1>Processing OAuth Callback...</h1>
  <script>
    // This function extracts the authorization code from the URL query parameters
    function getQueryParameter(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // Initialize the Google API client
    function handleClientLoad() {
      gapi.load('client:auth2', initClient);
    }

    // Initialize Google API client with your Client ID
    function initClient() {
      const params = new URLSearchParams(window.location.search);
      const code = params.get('code'); // Extract the authorization code from the URL

      if (code) {
        // Your OAuth Client ID (from Google Cloud Console)
        const clientId = '613073681590-ks3lg73f0t0a90j1h8al2dltn206mvcd.apps.googleusercontent.com';

        // Send the authorization code to your backend to exchange it for an access token
        fetch('/exchange-code', {  // Assuming this is the endpoint on your backend
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ code: code, clientId: clientId })
        })
        .then(response => response.json())
        .then(data => {
          if (data.access_token) {
            // Successfully obtained access token
            console.log('Access Token:', data.access_token);
            alert('Authentication successful!');

            // Store the access token in localStorage
            localStorage.setItem('access_token', data.access_token);

            // Optionally, redirect to the main page or wherever you need
            window.location.href = '/';  // Redirect to home page (or desired page)
          } else {
            alert('Failed to retrieve access token.');
          }
        })
        .catch(error => {
          console.error('Error during authentication:', error);
          alert('Something went wrong!');
        });
      } else {
        alert('No authorization code found in the URL.');
      }
    }

    // Call this function when the page loads
    handleClientLoad();
  </script>
</body>
</html>
